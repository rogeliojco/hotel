<% layout('layout/layout.ejs') %>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bs-stepper/dist/css/bs-stepper.min.css">
<style>
    /* Estilos generales */
    .bs-stepper {
        border: none; /* Elimina el borde del stepper */
        padding: 0;
    }

    .bs-stepper .step-trigger {
        padding: 10px 20px;
        border-radius: 20px; /* Hace los bordes más redondeados */
        font-weight: 500;
        color: #6c757d; /* Color de texto gris */
        background-color: #f8f9fa; /* Fondo gris claro */
        border: 1px solid #dee2e6; /* Borde sutil */
        display: flex;
        align-items: center;
        text-decoration: none; /* Elimina el subrayado */
    }

    .bs-stepper .step-trigger:hover {
        background-color: #e9ecef; /* Fondo un poco más oscuro al pasar el ratón */
    }

    .bs-stepper .step-trigger:not(:disabled):not(.disabled).active {
        background-color: #0d6efd; /* Fondo azul para el paso activo */
        color: white; /* Texto blanco para el paso activo */
        border-color: #0d6efd;
    }

    /* Círculos de los números */
    .bs-stepper .bs-stepper-circle {
        width: 30px;
        height: 30px;
        font-size: 0.8rem;
        background-color: #adb5bd; /* Círculo gris */
        color: white;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
    }

    .bs-stepper .step-trigger:not(:disabled):not(.disabled).active .bs-stepper-circle {
        background-color: white; /* Círculo blanco en el paso activo */
        color: #0d6efd; /* Texto azul en el círculo del paso activo */
    }

    /* Línea entre los pasos */
    .bs-stepper .line {
        background-color: #dee2e6; /* Línea gris */
        height: 2px;
        margin: 0 1rem;
    }

    /* Contenido de los pasos */
    .bs-stepper-content {
        padding: 20px;
        border: 1px solid #dee2e6; /* Borde alrededor del contenido */
        border-radius: 0.5rem;
        margin-top: 1rem;
    }

    /* Estilos para el stepper horizontal (si lo prefieres) */
    .bs-stepper.horizontal .bs-stepper-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1rem;
    }

    .bs-stepper.horizontal .line {
        flex: 1;
    }

    .bs-stepper.horizontal .step {
        flex: 0 0 auto;
        text-align: center;
    }
</style>

<div class="container mt-5">
    <h2 class="mb-4">Completar su Reserva</h2>

    <div id="stepper" class="bs-stepper horizontal">
        <div class="bs-stepper-header" role="tablist">
            <!-- Paso 1 -->
            <div class="step" data-target="#step-1">
                <button type="button" class="step-trigger" role="tab" id="step-1-trigger" aria-controls="step-1">
                    <span class="bs-stepper-circle">1</span>
                    <span class="bs-stepper-label">Detalles de la Reserva</span>
                </button>
            </div>
            <div class="line"></div>
            <!-- Paso 2 -->
            <div class="step" data-target="#step-2">
                <button type="button" class="step-trigger" role="tab" id="step-2-trigger" aria-controls="step-2">
                    <span class="bs-stepper-circle">2</span>
                    <span class="bs-stepper-label">Información Personal</span>
                </button>
            </div>
            <div class="line"></div>
            <!-- Paso 3 -->
            <div class="step" data-target="#step-3">
                <button type="button" class="step-trigger" role="tab" id="step-3-trigger" aria-controls="step-3">
                    <span class="bs-stepper-circle">3</span>
                    <span class="bs-stepper-label">Información de Pago</span>
                </button>
            </div>
        </div>

        <div class="bs-stepper-content">
            <form action="/confirmar-reserva" method="POST">
                <!-- Campos ocultos para enviar las fechas, el número de noches y el precio total -->
                <input type="hidden" name="fechas" value="<%= data.fechas %>">
                <input type="hidden" name="numeroNoches" value="<%= data.numeroNoches %>">
                <input type="hidden" name="precioTotal" value="<%= data.precioTotal %>">

                <!-- Paso 1: Detalles de la Reserva -->
                <div id="step-1" class="content" role="tabpanel" aria-labelledby="step-1-trigger">
                    <h4 class="mb-3">Habitaciones Seleccionadas</h4>

                    <p><strong>Fechas de la reserva:</strong> <%= data.fechas %></p>
                    <p><strong>Número de noches:</strong> <%= data.numeroNoches %></p>
                    <p><strong>Precio total:</strong> $<%= data.precioTotal %> MXN</p>

                    <% if (data.habitaciones.length > 0) { %>
                        <% data.habitaciones.forEach((habitacion, index) => { %>
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title"><%= habitacion.nombre %></h5>
                                    <p class="card-text"><%= habitacion.descripcion %></p>
                                    <p class="card-text"><strong>Capacidad:</strong> <%= habitacion.tipo %></p>
                                    <p class="card-text"><strong>Precio por noche:</strong> $<%= habitacion.precioNoche %> MXN</p>
                                </div>

                                <!-- Campo oculto para enviar el ID de la habitación -->
                                <input type="hidden" name="habitaciones[<%= index %>][id]" value="<%= habitacion._id %>">
                                <!-- Campo oculto para enviar el nombre de la habitación -->
                                <input type="hidden" name="habitaciones[<%= index %>][nombre]" value="<%= habitacion.nombre %>">
                                <!-- Campo oculto para enviar el precio de la habitación -->
                                <input type="hidden" name="habitaciones[<%= index %>][precioNoche]" value="<%= habitacion.precioNoche %>">
                            </div>
                        <% }); %>
                    <% } else { %>
                        <p>No se seleccionaron habitaciones.</p>
                    <% } %>
                    <!-- Botones de navegación -->
                    <div class="d-flex justify-content-end">
                        <button class="btn btn-primary" onclick="stepper.next()">Siguiente</button>
                    </div>
                </div>

                <!-- Paso 2: Información Personal -->
                <div id="step-2" class="content" role="tabpanel" aria-labelledby="step-2-trigger">
                    <h4 class="mb-3">Información Personal</h4>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label for="nombre" class="form-label">Nombre Completo</label>
                            <input type="text" class="form-control" id="nombre" name="nombre" value="<%= data.user ? data.user.name : '' %>" required>
                        </div>
                        <div class="col-md-6">
                            <label for="email" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="email" name="email" value="<%= data.user ? data.user.email : '' %>" required>
                        </div>
                        <div class="col-md-6">
                            <label for="telefono" class="form-label">Teléfono</label>
                            <input type="tel" class="form-control" id="telefono" name="telefono" required>
                        </div>
                    </div>
                    <!-- Botones de navegación -->
                    <div class="d-flex justify-content-between">
                        <button class="btn btn-secondary" onclick="stepper.previous()">Anterior</button>
                        <button class="btn btn-primary" onclick="stepper.next()">Siguiente</button>
                    </div>
                </div>

                <!-- Paso 3: Información de Pago -->
                <div id="step-3" class="content" role="tabpanel" aria-labelledby="step-3-trigger">
                    <h4 class="mb-3">Información de Pago</h4>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label for="tarjeta" class="form-label">Número de Tarjeta</label>
                            <input type="text" class="form-control" id="tarjeta" name="tarjeta" required>
                        </div>
                        <div class="col-md-3">
                            <label for="vencimiento" class="form-label">Fecha de Vencimiento</label>
                            <input type="text" class="form-control" id="vencimiento" name="vencimiento" placeholder="MM/AA" required>
                        </div>
                        <div class="col-md-3">
                            <label for="cvv" class="form-label">CVV</label>
                            <input type="text" class="form-control" id="cvv" name="cvv" required>
                        </div>
                        <div class="col-md-6">
                            <label for="titular" class="form-label">Nombre del Titular</label>
                            <input type="text" class="form-control" id="titular" name="titular" required>
                        </div>
                    </div>
                     <!-- Botones de navegación -->
                    <div class="d-flex justify-content-between">
                        <button class="btn btn-secondary" onclick="stepper.previous()">Anterior</button>
                        <button type="submit" class="btn btn-danger btn-lg">Confirmar Reserva</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bs-stepper/dist/js/bs-stepper.min.js"></script>
<script>
    var stepper = new Stepper(document.querySelector('#stepper'), {
        linear: false,
        animation: true
    });
</script>